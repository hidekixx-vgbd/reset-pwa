<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>RESET.</title>

<style>
body{
  margin:0;
  background:#0a0a0a;
  color:#fff;
  font-family:-apple-system,BlinkMacSystemFont,"Segoe UI",sans-serif;
  display:flex;
  justify-content:center;
  align-items:center;
  height:100vh;
  text-align:center;
}

.screen{
  display:none;
  width:90%;
  max-width:420px;
  opacity:0;
  transition:opacity 0.4s ease;
}

.screen.active{
  display:block;
  opacity:1;
}

button{
  width:100%;
  padding:18px 0;
  margin-top:16px;
  background:transparent;
  border:none;
  border-bottom:1px solid #222;
  color:#fff;
  font-size:18px;
  letter-spacing:1px;
}

input{
  width:100%;
  padding:16px;
  margin-top:20px;
  background:transparent;
  color:#fff;
  border:none;
  border-bottom:1px solid #222;
  font-size:16px;
}

.big{
  font-size:22px;
  line-height:1.8;
  letter-spacing:0.5px;
  margin-top:40px;
  white-space:pre-line;
}
</style>
</head>

<body>

<div id="category" class="screen active">
  <button onclick="selectCategory('work')">仕事</button>
  <button onclick="selectCategory('relation')">人</button>
  <button onclick="selectCategory('control')">不安</button>
  <button onclick="selectCategory('self')">自分</button>
</div>

<div id="input" class="screen">
  <input id="context" placeholder="何が起きた？（任意）">
  <button onclick="selectEmotion('怒り')">怒り</button>
  <button onclick="selectEmotion('焦り')">焦り</button>
  <button onclick="selectEmotion('不安')">不安</button>
  <button onclick="selectEmotion('苛立ち')">苛立ち</button>
  <button onclick="selectEmotion('落胆')">落胆</button>
</div>

<div id="zen" class="screen">
  <p id="zenText" class="big"></p>
</div>

<div id="action" class="screen">
  <p id="actionText" class="big"></p>
  <button onclick="restart()">終わる</button>
</div>

<script>

let state={
  category:null,
  context:"",
  emotion:null,
  zenType:null
};

const ZEN={
  dualism:"いま、評価の二元に\n引き寄せられている可能性。",
  attachment:"いま、結果への執着が\n強まっている可能性。",
  impermanence:"いま、変化を固定しようとしている\n可能性。"
};

const ACTIONS=[
  "何もしない。",
  "言葉にしない。",
  "触らない。",
  "席を立つ。",
  "決めない。",
  "離す。",
  "置いておく。",
  "画面を閉じる。",
  "手を止める。",
  "見ない。"
];

function show(id){
  document.querySelectorAll(".screen").forEach(s=>{
    s.classList.remove("active");
  });
  const target=document.getElementById(id);
  target.classList.add("active");
}

function selectCategory(cat){
  state.category=cat;
  show("input");
}

function selectEmotion(em){
  state.emotion=em;
  state.context=document.getElementById("context").value;
  classify();
}

function classify(){
  const text=(state.context||"").toLowerCase();

  let dual=0, attach=0, imper=0;

  if(state.emotion==="怒り"||state.emotion==="苛立ち") dual++;
  if(state.emotion==="不安"||state.emotion==="焦り") attach++;
  if(state.emotion==="落胆") imper++;

  if(text.includes("評価")||text.includes("否定")||text.includes("比較")) dual+=2;
  if(text.includes("思い通り")||text.includes("期待")||text.includes("コントロール")) attach+=2;
  if(text.includes("変化")||text.includes("先が見えない")||text.includes("どうなる")) imper+=2;

  const max=Math.max(dual,attach,imper);

  if(max===dual) state.zenType="dualism";
  else if(max===imper) state.zenType="impermanence";
  else state.zenType="attachment";

  document.getElementById("zenText").innerText=ZEN[state.zenType];
  show("zen");

  setTimeout(()=>{
    const action=ACTIONS[Math.floor(Math.random()*ACTIONS.length)];
    document.getElementById("actionText").innerText="\n\n"+action;
    show("action");
  },1000);
}

function restart(){
  state={category:null,context:"",emotion:null,zenType:null};
  document.getElementById("context").value="";
  show("category");
}

</script>
</body>
</html>
